<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thống kê doanh thu</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/header') %>

    <div class="container">
        <h1> Thống kê doanh thu</h1>
        <a href="/admin/products" class="back-btn">← Quay về quản lý sản phẩm</a>

        <div class="revenue-summary">
            <h2>Tổng quan</h2>
            <p><strong>Tổng số đơn hàng:</strong> <%= totalOrders %></p>
            <p><strong>Tổng doanh thu (chưa thuế):</strong> <%= totalRevenue.toLocaleString() %> VNĐ</p>

            <% 
                const totalTax = Math.round(totalRevenue * 0.08);
                const totalAfterTax = totalRevenue + totalTax;
            %>
            <p><strong>Thuế (8%):</strong> <%= totalTax.toLocaleString() %> VNĐ</p>
            <p><strong>Tổng doanh thu sau thuế:</strong> <%= totalAfterTax.toLocaleString() %> VNĐ</p>
        </div>

        <div class="order-details">
            <h2>Chi tiết đơn hàng</h2>
            <% if (orders.length === 0) { %>
                <p>Chưa có đơn hàng nào.</p>
            <% } else { %>
                <% orders.forEach(order => { %>
                    <div class="order-box">
                        <p><strong>Mã đơn:</strong> <%= order.id %></p>
                        <p><strong>Khách hàng:</strong> <%= order.user %></p>
                        <p><strong>Thời gian đặt:</strong> <%= order.date %></p>

                        <table class="order-table">
                            <thead>
                                <tr>
                                    <th>Sản phẩm</th>
                                    <th>Size</th>
                                    <th>Số lượng</th>
                                    <th>Đơn giá</th>
                                    <th>Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% order.items.forEach(item => { %>
                                    <tr>
                                        <td><%= item.name %></td>
                                        <td><%= item.size %></td>
                                        <td><%= item.quantity %></td>
                                        <td><%= item.price.toLocaleString() %></td>
                                        <td><%= item.total.toLocaleString() %></td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>

                        <p><strong>Tạm tính:</strong> <%= order.subtotal.toLocaleString() %> VNĐ</p>
                        <p><strong>Thuế (8%):</strong> <%= order.tax.toLocaleString() %> VNĐ</p>
                        <p><strong>Tổng cộng:</strong> <%= order.grandTotal.toLocaleString() %> VNĐ</p>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>
</body>
</html>
